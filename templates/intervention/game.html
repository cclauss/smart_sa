{% extends "base.html" %}
{% load participant_status %}
{% block js %}
   <script type="text/javascript" src="/site_media/js/mochikit/MochiKit/MochiKit.js"></script>
   <script type="text/javascript" src="/site_media/js/static_auth/local_session.js"></script>    
   <script type="text/javascript" src="/site_media/js/static_auth/intervention_storage.js"></script>    
   
   <!-- Delegate to the particular game which extra JS it needs -->
   <script>
     var game_variables = {{game.variables|safe}};
     this.ss_game_state = {};
     
    {% for v in game_variables %}
         {% if v.value %}
             this.ss_game_state['{{v.key}}'] = {{v.value|safe}};
         {% else %}
             this.ss_game_state['{{v.key}}'] = {};
         {% endif %}
    {% endfor %}
    
   </script>
   {% block game_js %}{% endblock %}
{% endblock %}

{% block css %}
   <!-- Delegate to the particular game extra CSS it needs -->
   {% block game_css %}{% endblock %}
{% endblock %}

{% block breadcrumb-main %}
<div id="breadcrumb-main">
	<a href="/intervention/">Home</a> &rarr; Intervene &rarr; Working with <b>{{participant.name}}</b> 
</div>
{% endblock %}

{% block breadcrumb-session %}
    {%if game %}
<div id="breadcrumb">
      <a class="incomplete" id="tab-home" href="/intervention/{{game.activity.clientsession.intervention.id}}/">Sessions</a>
	<div id="breadcrumb-text">
		You are currently in: Session {{game.activity.clientsession.index}}: {{game.activity.clientsession.long_title}} &rarr; <span class="breadcrumb-text-current">Activity {{game.activity.index}}: {{ game.activity.long_title }}</span>
	</div>
</div>
    {%endif%}  
    {% if participant.is_practice %}
    <div class="practice-mode">Practice Mode - This intervention is for demonstration purposes only.</div>
    {% endif %}
{% endblock %}

{% block content %}

  {{ block.super }}

		<div id="side">
			<h2 id="sessioninfo" class="{% get_participant_status participant game.activity.clientsession %}">
				<a href="/session/{{game.activity.clientsession.id}}/">Session {{game.activity.clientsession.index}}: {{game.activity.clientsession.long_title}}</a>
			</h2>
			<div id="nav-side">
				<ul>
				{% for a in game.activity.clientsession.activity_set.all %}
				<li><a class="{% get_participant_status participant a %}
				{% if forloop.first %}first{% endif %}
				{% if forloop.last %}last{% endif %}
				{% ifequal a.id game.activity.id %}current{% endifequal %}
				" href="/activity/{{a.id }}/">{{a.long_title}}</a>
				{% if a.game %}<span class="task">+Task</span>{% endif %}
				</li>
				{% endfor %}
				</ul>
			</div>

		</div>

		<div id="content">
		
			<div id="session{{game.activity.clientsession.id}}" class="parentsession"></div>
			
			<div class="nav-lateral" id="top-nav-lateral">
			  {% with activity.next as next_activity %}
			     {% if next_activity %}
				<a href="/activity/{{next_activity.id }}/">Next &rarr;</a> 
                             {% else %}
				Next &rarr;
                             {% endif %}
			  {% endwith %}
			  {% with activity.prev as prev_activity %}
				{% if prev_activity %}
				<a href="/activity/{{prev_activity.id }}/">&larr; Previous</a> 
				{% else %}
				&larr; Previous
				{% endif %}
			  {% endwith %}
			</div>
			
			<h3 id="activity{{game.activity.id}}" class="activitytitle">Activity {{game.activity.index}}: {{ game.activity.long_title }}</h3>
			
			<h4>Client Task: Part {{game.index}}/{{game.activity.pages|length}}</h4>
			
			<div>
			<p class="game_instructions">
			{{game.instructions|safe}}
			</p>

			{% if game.next_url %}
			
			<a id="next-game-part-link" class="hilite" href="{{game.next_url}}.html">
			{%if game.next_title%}
			Next: {{game.next_title}}
			{%else%}
			NEXT PART
			{%endif%}
			</a>
			<span class="cent_or">or</span>
			
			{% else %}
			
			<a id="complete" class="hilite" href="/activity/{{game.activity.id}}/complete/" >
			COMPLETE
			</a><span class="cent_or">or</span>
			
			{% endif %}
			{% if game.previous_url %}
			<a class="off" href="{{game.previous_url}}.html">
			{%if game.prev_title%}{{game.prev_title}}
			{%else%}
			PREVIOUS PART
			{%endif%}
			</a>
			{% endif %}
			<a class="off" href="/activity/{{game.activity.id}}/">return to task overview</a>
			<a class="off" href="/session/{{game.activity.clientsession.id}}/">return to agenda</a>
			{%if debug%}
			<a class="off" href="#BEWARE" onclick="if(confirm('sure?')){Intervention.resetGame();}return false;">Reset Task for this User</a>
			{%endif%}

			<!-- START - Delegate HTML to the particular game -->
			{% block game_content %}{% endblock %}
			<!-- STOP Delegate HTML to the particular game -->
			
			</div>
			
			<div class="nav-lateral" id="bottom-nav-lateral">
			  <a id="top" href="#pagestart">&uarr; Back to Top</a>
			  {% with activity.next as next_activity %}
			     {% if next_activity %}
				<a href="/activity/{{next_activity.id }}/">Next &rarr;</a> 
                             {% else %}
				Next &rarr;
                             {% endif %}
			  {% endwith %}
			  {% with activity.prev as prev_activity %}
				{% if prev_activity %}
				<a href="/activity/{{prev_activity.id }}/">&larr; Previous</a> 
				{% else %}
				&larr; Previous
				{% endif %}
			  {% endwith %}
			</div>

		</div>

{% endblock %}
